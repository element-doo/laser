<!DOCTYPE html>
<html lang="en-US">
<head>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" media="all" href="/bljuv.css"/>
</head>
<body>

<div>
    <div>
        <textarea class="rule-editor"  rows="10" placeholder="rules: fromRegex  =>  to"></textarea>
        <button class="validate-rules btn btn-primary" type="button">Validate rules</button>
        <button class="transform btn btn-large btn-primary" type="button">Transform</button>
        <a href="help.html">HELP!</a>
    </div>
    <div class="editors">
            <textarea class="editor editor-left"  rows="50" placeholder="Input text to replace"></textarea>
            <textarea class="editor editor-right" rows="50" placeholder="Result goes here"/></textarea>
    </div>
</div>


<script>
            $.ajax({
                type: 'GET',
                url: '/rules/default',
                contentType: "application/json",
                dataType: 'json'
            }).complete(function(res) {
                $(".rule-editor").val(res.responseText)
            });

           $('.validate-rules').click(function(event) {
               var context = $(this);
               var text = $(".rule-editor").val();
               $.post('/rules/validate', text, function (data) {
                   alert(data)
               }).fail(function (result) {
                   alert(result.responseText);
               });

           });

           $('.transform').click(function(event) {
               var context = $(this);
               var rules = $(".rule-editor").val();
               var text = $(".editor-left").val();
               var data = {
                   rules: rules,
                   text: text
               };
               $.ajax({
                   type: 'POST',
                   url: '/rules/transform',
                   data: JSON.stringify(data), // or JSON.stringify ({name: 'jonas'}),
                   contentType: "application/json",
                   dataType: 'json'
               }).complete(function(res) {
                   $(".editor-right").val(res.responseText)
               });

               $.ajax({
                   type: 'POST',
                   url: '/rules/default',
                   data: data.rules, // or JSON.stringify ({name: 'jonas'}),
                   contentType: "application/json",
                   dataType: 'json'
               }).complete(function(res) {
                   alert("stored: "+data)
               })

           });

           $(".editor-left").on("scroll", function(){
               $(".editor-right").scrollTop(this.scrollTop)
           });
</script>
</body>
</html>
